<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <title>Avoid GO!</title>
</head>

<body>
    <div style="text-align: center;">
        <canvas id="canvas" width="500" height="300" style="border: 2px solid black"></canvas>
        <h2 id="status">空白鍵開始遊戲</h2>
    </div>

    <script>
        let x = 25;
        var oxs = [];
        var oys = [];
        var ocolors = [];
        const WIDTH = 50;
        const HEIGHT = 30;
        const BLOCK_SIZE = 10;

        var ctx = document.getElementById("canvas").getContext("2d");

        function update(d) {
            if (d === "ArrowLeft" && x > 0) x--;
            else if (d === "ArrowRight" && x < 49) x++;

            ctx.clearRect(0, 0, 2000, 2000);

            ctx.strokeStyle = "#e9e9e9";
            ctx.lineWidth = 2;

            ctx.beginPath();

            for (let x = 0; x <= WIDTH; x++) {
                ctx.moveTo(BLOCK_SIZE * x, 0);
                ctx.lineTo(BLOCK_SIZE * x, HEIGHT * BLOCK_SIZE);
            }

            for (let y = 0; y <= HEIGHT; y++) {
                ctx.moveTo(0, y * BLOCK_SIZE);
                ctx.lineTo(WIDTH * BLOCK_SIZE, y * BLOCK_SIZE);
            }

            ctx.stroke();

            for (let i = 0; i < oxs.length; i++) {
                ctx.fillStyle = ocolors[i];
                console.log(ocolors[i]);
                ctx.fillRect(BLOCK_SIZE * oxs[i], BLOCK_SIZE * oys[i], BLOCK_SIZE, BLOCK_SIZE);

                if (oxs[i] === x && oys[i] === 25) {
                    oxs.length = 0;
                    oys.length = 0;
                    update();

                    started = false;
                    document.getElementById("status").innerText = "你失敗了!\n分數: " + score + " / 500";
                }
                else if (score > 499) {
                    oxs.length = 0;
                    oys.length = 0;
                    update();

                    started = false;
                    document.getElementById("status").innerText = "你贏了!\n分數: 500 / 500\n空白鍵在玩一次";
                }
            }

            ctx.fillStyle = "black";
            ctx.fillRect(BLOCK_SIZE * x, BLOCK_SIZE * 25, BLOCK_SIZE, BLOCK_SIZE);
        }
        update();

        let started = false;
        document.body.addEventListener('keydown', (e) => {
            if (e.key === "ArrowRight" || e.key === "ArrowLeft") update(e.key);

            if (e.key === " " && !started) started = true;
        });

        setInterval(() => {
            if (started) spawn_blocks();
        }, 100);

        let score = 0;
        function spawn_blocks() {
            const color = '#' + (Math.random() * 0xFFFFFF << 0).toString(16);

            for (let i = 0; i < oys.length; i++) {
                oys[i] = oys[i] + 1;
            }

            for (let i = 0; i < WIDTH; i++) {
                const r = Math.random();

                if (r < 0.05) {
                    oys.push(0);
                    oxs.push(i);
                    ocolors.push(color);
                }
            }

            score++;
            document.getElementById("status").innerText = "分數: " + score + " / 500";

            update();
        }
    </script>
</body>

</html>
